# Техническое задание

### Цель приложения
Массовое переименование файлов в указанном каталоге по заданным шаблонам.

### Требования к функциональным характеристикам
- Управление с помощью клавиатуры
- Досрочный выход из приложения
- Переименование файлов по шаблону
- Изменение регистра в имени файла
- Выбор каталога
- Массовое изменение расширений файлов 
- Проверка на корректность введенных шаблонов
#### Возможный функционал приложения:
- Рекурсивный обход каталогов
- Игнорирование выбранных файлов
- Вывод всех файлов в указанном каталоге 
- Запись всех процессов в log файл
- Возможность добавлять новые шаблоны к уже записанным
- Возможность изменять шаблоны после их записи
- Сокращение имен файлов до первых n-ых символов 
- Добавление текущего времени к имени файла
---

### Структура программы
![](https://github.com/tobusoo/prog/blob/main/structur.png)

---


### База данных
- Для хранения шаблонов будет использоваться связанный список. В каждой ячейке данного списка будет хранится только строка с шаблоном.
- Для хранения пути к выбранному каталогу будет достаточно обычного массива типа char.
- Выбранные опции будут хранится в соотвествующей структуре. Каждое поле структуры может быть либо true, либо false.
- Файлы, подлежащие к переименованию, будут хранится в связанном списке структур. В структуре будут хранится сведения о файле: путь к файлу, имя файла, новое имя файла, новый путь к файлу, поле со статусом переименования (true - переименован, false - не переименован) и т.д. 
---

### Логика приложения
- После запуска приложения появляется интерфейс для взаимодействия с пользователем, также создаются все структуры и связанные списки, которые в дальнейшем могут понадобиться. Если пользователь захочет ввести шаблоны, то открывается новое "окно" в терминале, в котором можно вводить шаблоны. В данное "окно" передается связанный список, в котором будут хранится шаблоны. После каждого успешного ввода шаблон добавляется в связанный список. После окончания ввода шаблонов связанный список возвращается. Обработка шаблонов и алгоритм обработки шаблонов приведены ниже.
- Если пользователь захочет сменить каталог, то вновь открывается новое "окно". Перед тем, как отобразить все доступные подкаталоги, программа обрабывает все файлы в текущей директории. Каждый файл необходимо проверить на то, что он является директорией. Если это так, то данный файл добавляется в список. После обработки всех файлов выводиться список доступных подкаталогов в интерфейсе. Теперь пользователь может выбрать необходимый для него каталог. После выбора каталога возвращается строка с выбранным каталогом. Выбранный каталог обновляется в интерфейсе и в базе данных.
- Если пользователь желает изменить стандартные опции, то открывается новое "окно" с опциями. В это "окно" передается структура с опциями, после чего выводятся текущии выбранные опции. Для изменения опции пользователь нажимает ENTER на клавиатуре. После этого программа изменяет поле конкретной опции в структуре с true на false или с false на true.  
- После запуска переименования программа передаёт список шаблонов, выбранный каталог, структуру с каталогами и список структур с файлами в программный блок. Сначала программа должна проверить каждый файл в выбранном каталоге на сходство с шаблонами. Если файл подходит под шаблон, то информация о нем добавляется в список с файлами для переименования. После обработки всех файлов в выбранном каталоге программа передает список файлов в программный блок для переименования. В данном блоке каждый файл передается в функцию для переименовывания файлов. Функция должна принимать путь файла и его новое имя. В случае успеха функция возвращает true, иначе false. После переименовывания всех файлов данный программный блок возвращает список успешно переименованных файлов. После этого в интерфейсе этот список выводится.  
---

### Обработка шаблонов
#### Допустимые метасимволы:
- `?` - Соответствует любому одиночному символу.
- `*` - Соответствует любой последовательности символов (включая пустую последовательность).

`:` - Разделительный символ между шаблоном для поиска и шаблоном для переименования. Слева и справа от данного символа может быть любое количество пробелов.

#### Примеры шаблонов:
- `*.jpg : *.jpeg` - Изменение расширения файлов с jpg на jpeg. `image.jpg` : `image.jpeg`
- `hell*.txt : hello*.txt` - `hellabc.txt` : `helloabc.txt`
- `hell*.txt : hell*o.txt` - `hellabc.txt` : `hellabco.txt`
- `* : file-*.old` - Каждый файл будет переименован на file-{old_name}.old. Старое расширение не сохраняется. `main.c` : `file-main.old`
- `* : file-*.*` - Каждый файл будет переименован на file-{old_name}.*. Старое расширение сохраняется. `main.c` : `file-main.с`
- `coo?.txt : coo?o.txt` - К концу имени файла добавляется символ `o`.  `cool.txt` : `coolo.txt`
- `*.txt : ????.txt` - Имя файлов сокращается до первых 4 символов. `geometry.txt` : `geom.txt`
- `hell*.txt : hell?.txt` - `hellooooo.txt` : `hello.txt` 

#### Пример шаблона для вывода времени переименования файла:
- `*.txt : *_{time}.txt` - Добавление времени к концу имени файла. `one_piece.txt` : `one_piece_19_03_2023.txt`
- `*.txt : *_{time}.dat` - Добавление времени к концу имени файла и изменение расширения. `one_piece.txt` : `one_piece_19_03_2023.dat`

Использование `{time}` возможно будет реализовано.

#### Примеры ошибочных шаблонов:
- `hello.txt : ` - Отсуствует шаблон для переименования.
- ` : hell*.txt` - Отсуствует шаблон для поиск.
- `hell?.txt : hell*.txt` - Использование `*` в шаблоне для переименования без использования `*` в шаблоне для поиска недопустимо (`hell*.txt : hell?.txt` допустимо).  
- `hel**.txt : hello*.txt` - Использование двух символов `*` в одном шаблоне недопустимо.
- `hello*.txt :: hello*a.txt` - Использование двух разделительных символов `:` недопустимо.
- `hello*.txt hello.txt` - Нет разделительного символа `:`.
- `hello*.txt hello.txt :` - Разделительный символ `:` стоит не на своём месте.
---

### Алгоритмы обработки шаблонов
#### Алгоритм первичной обработки шаблонов
После пользовательского ввода шаблона его необходимо проверить на корректность.

Список проверок:
- Символ `*` не встречается дважды в одном шаблоне. 
- Шаблоны не пустые.
- Разделительный символ `:` встречается один раз и находится между шаблонами для поиска и переименования.
- Символ `*` не встречается в шаблоне для переименования без использования символа `*` в шаблоне для поиска

Если какое-то из этих проверок не выполнилось, то обработка текущего шаблона прекращается. Шаблон будет проигнорирован.
В ином случае данный шаблон будут дабовлен в список шаблонов. 

#### Алгоритм поиска файлов по шаблону
После обработки текущей директории данному алгоритму передается список имен всех файлов и список введенных шаблонов. 
Каждое имя файла сопостовляется с каждым шаблоном. Если имя файла подходит под один из шаблонов, то имя данного файла и шаблон добавлются в список файлов для переименования. Если имя файла не подошло ни под один из шаблонов, то алгоритм приступит к обработке следующего имени файла, либо же завершит работу, если все файлы были обработаны.

#### Алгоритм переименования файлов по шаблону
На вход подается список файлов для переименования. По шаблону для переименования алгоритм создает новое имя для файла, после чего пытается переименовать файл. Если такой файл уже существует, то к новому имени добавляется порядковый номер. Например, файл `file_exist.txt` уже существует, тогда будет произведена попытка переименовать файл в `file_exist (1).txt`, если вновь не удалось, то в `file_exist (2).txt` и т.д. После успешного переименования всех файлов возвращается список с переименованными файлами.

---

### Интерфейс приложения
Приложение работает в терминале.

#### Главное меню приложения:
![](https://github.com/tobusoo/prog/blob/main/menu.png)

Пользователь имеет возможность перемещаться по пунктам, используя стрелочки на клавиатуре и клавиши 1-5 на клавиатуре для соотвествующих пунктов. Для выбора пункта необходимо нажать ENTER на клавиатуре. В ле
вом нижнем углу интерфейса выводится текущий выбранный каталог (по умолчанию "."), а также название пункта, на котором находится пользователь

#### Ввод шаблонов:
![](https://github.com/tobusoo/prog/blob/main/vibor.png)

После выбора пункта "1) Ввести шаблоны" появляется новое "окно" в терминале, в котором пользователь может вводить шаблоны. Если шаблон введен некорректно, то выводится предупреждение об этом. Такие шаблоны будут игнорироваться. Приложение будет считывать шаблоны до того момента, пока не будет введена пустая строка.

#### Выбор каталогов: 
![](https://github.com/tobusoo/prog/blob/main/katalog.png)

После выбора пункта "2) Выбрать каталог" появляется новое "окно" в терминале, в котором пользователь может выбрать каталог для работы в нем. Выводяться только те каталоги, к которым есть прямой доступ из текущего каталога. Перемещаться в данном окне можно с помощью стрелочек на клавиатуре. Чтобы выбрать каталог, необходимо нажать на ENTER. После выбора нового каталога в левом нижнем углу интерфейса будет отображаться новый каталог. После выбора каталога, необходимо выбрать пункт "Вернуться обратно в меню"

#### Запуск массового переименования:
![](https://github.com/tobusoo/prog/blob/main/run.png)

После выбора пункта "3) Запустить массовое переименование" появляется новое "окно" в терминале, в котором отображается процесс переименования файлов. После успешного переименования выводится список всех переименованных файлов. Если шаблоны не были введены, то приложение будет выводить предупреждение.

#### Выбор опций:
![](https://github.com/tobusoo/prog/blob/main/Option.png)

После выбора пункта "4) Опции" появляется новое "окно" в терминале, в котором пользователь может изменять опции. Пользователь также может перемещаться по опциям при помощи стрелочек на кливиатуре. 
"Yes" означает, что опция включена. 
"No" означает, что опция отключена.
Для включения/отключения опций необходимо нажимать на ENTER.

#### Завершение работы:
После выбора пункта "5) Выход из приложения" программа завершает свою работу. Также это можно сделать, нажав на F1.

---
